new WOW().init();

jQuery(document).ready(function ($) {

    $('#main_modal').find('.button').on('click', function(){
        $('#main_modal').modal('toggle');
    })

    $.each($('.wp-megamenu-sub-menu li:nth-child(1) img'), function () {
        let href = $(this).parent().next().find('a').attr('href');

        $(this).wrap('<a href="'+ href +'"></a>');
    });

    $('.our_clients_slider').mCustomScrollbar({
        axis: "x",
        scrollButtons: {enable: false},
        theme: "3d",
        scrollbarPosition: "outside",
        contentTouchScroll: true,
        mouseWheelPixels:0,
        scrollInertia:50,
        mouseWheel:true,
        updateOnContentResize:true,
        // mouseWheel:{
        //     enable: true,
        //     axis: "x",
        //     preventDefault: true
        // }
    });

    $('.our_clients_slider').find('.mCSB_draggerRail').appendTo($('.our_clients_slider').find('.mCSB_draggerContainer'))

    $('.planing_slider').mCustomScrollbar({
        axis: "x",
        scrollButtons: {enable: true},
        theme: "3d",
        scrollbarPosition: "outside",
        contentTouchScroll: true,
        mouseWheelPixels:0,
        scrollInertia:50,
        mouseWheel:true,
        updateOnContentResize:true,
        alwaysShowScrollbar: 0
    });

	$('.planing_slider').find('.mCSB_draggerContainer').find('.mCSB_draggerRail').remove();
      $('.planing_slider').find('.mCSB_draggerRail').appendTo($('.planing_slider').find('.mCSB_draggerContainer'))

    $('.right_slider').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        arrows: false,
        fade: true,
        asNavFor: '.left_slider',
        draggable: false,
        swipe: false,
        swipeToSlide: false,
        touchMove: false,
        accessibility: false,
        // speed: 1000
    });

    $('.left_slider').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        asNavFor: '.right_slider',
        focusOnSelect: true,
        fade: true,
        // speed: 1000,
        nextArrow: '<img class="next" alt="Next item on the list." title="Next item on the list." src="' + settings.distUrl + '/img/next.png">',
        prevArrow: '<img class="prev" alt="Previous item on the list." title="Previous item on the list." src="' + settings.distUrl + '/img/prev.png">'
    });

    var ourTeam = $('.our_team_slider_wrapper');

    var teamSliderDesktop = {
        slidesToShow: 3,
        slidesToScroll: 1,
        asNavFor: '.carousel-content-desktop',
        nextArrow: $('button[ data-toggle="next"]'),
        prevArrow: $('button[ data-toggle="prev"]'),
    };
    var teamSliderMobile = {
        slidesToShow: 1,
        slidesToScroll: 1,
        asNavFor: '.carousel-content-mobile',
        nextArrow: $('button[ data-toggle="next"]'),
        prevArrow: $('button[ data-toggle="prev"]'),
    };

    var teamNames = {
        slidesToShow: 1,
        slidesToScroll: 1,
        asNavFor: '.our_team_slider_wrapper',
        fade: true,
        arrows: false,
    };



    if($(window).width() < 768) {
        ourTeam.slick(teamSliderMobile);
        $('.carousel-content-mobile').slick(teamNames);
    } else {
        ourTeam.slick(teamSliderDesktop);
        $('.carousel-content-desktop').slick(teamNames);
    }

    $(window).on('resize', function () {
        if($(window).width() < 768) {
            ourTeam.slick(teamSliderMobile);
            $('.carousel-content-mobile').slick(teamNames);
        } else {
            ourTeam.slick(teamSliderDesktop);
            $('.carousel-content-desktop').slick(teamNames);
        }
    });


    $('.testimonials_slider').slick({
        slidesToShow: 1,
        slidesToScroll: 1,
        fade: true,
        dots: false,
        arrows: true,
        appendArrows: $('.testimonials_slider_control'),
        // nextArrow: '<img class="next" src="' + settings.distUrl + '/img/testimonials_next.png">',
        // prevArrow: '<img class="prev" src="' + settings.distUrl + '/img/testimonials_prev.png">'
        nextArrow: '<svg style="transform: rotate(180deg)" xmlns="http://www.w3.org/2000/svg" width="44" height="19" viewBox="0 0 44 19" fill="none"><path d="M43 9.93064H1M1 9.93064L15.6667 1.91797V17.9433L1 9.93064Z" stroke="#C1BECB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',
        prevArrow: '<svg xmlns="http://www.w3.org/2000/svg" width="44" height="19" viewBox="0 0 44 19" fill="none"><path d="M43 9.93064H1M1 9.93064L15.6667 1.91797V17.9433L1 9.93064Z" stroke="#C1BECB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>'
    });

    $("body").mousemove(function (e) {
        parallaxIt(e, "svg .move", -20);
        parallaxIt(e, "svg .move1", 20);
    });

    function parallaxIt(e, target, movement) {
        var $this = $("body");
        var relX = e.pageX - $this.offset().left;
        var relY = e.pageY - $this.offset().top;

        TweenMax.to(target, 1, {
            x: (relX - $this.width() / 2) / $this.width() * movement,
            y: (relY - $this.height() / 2) / $this.height() * movement
        });
    }

    function isEmail(email) {
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        return regex.test(email);
    }

    var contactForm = $('.contact_us').find('form');
    contactForm.find('input[type="file"]').on('change', function (e) {
        var fileName;
        if (e.target.files[0]) {
            fileName = e.target.files[0].name;
            $('.label').addClass('active');
        } else {
            fileName = $('.label').attr('data-default');
            $('.label').removeClass('active');
        }

        $('.label').text(fileName);

    });

    contactForm.find('input:not(input[type=file]), textarea').on('focus', function () {
        $(this).closest('label').find('.input_placeholder').addClass('active');
    });

    contactForm.find('input:not(input[type=file]), textarea').on('focusout', function () {
        if (!$(this).val()) {
            $(this).closest('label').find('.input_placeholder').removeClass('active');
        }

        if ('input[type="email"]' && $(this).val()) {
            if (isEmail($(this).val())) {
                $(this).closest('label').find('.email_warning').fadeOut(300);
            } else {
                $(this).closest('label').find('.email_warning').fadeIn(300);
            }
        }
    });

    $('textarea[name="your-message"]').on('keyup paste', function() {
        var $el = $(this),
            offset = $el.innerHeight() - $el.height();

        if ($el.innerHeight() < this.scrollHeight) {
            // Grow the field if scroll height is smaller
            $el.height(this.scrollHeight - offset);
        } else {
            // Shrink the field and then re-set it to the scroll height in case it needs to shrink
            $el.height(1);
            $el.height(this.scrollHeight - offset);
        }
    });

    $('.similar_posts_slider').slick({
        slidesToShow: 3,
        slidesToScroll: 3,
        dots: false,
        nextArrow: $('.similar_posts_slider_next svg'),
        prevArrow: $('.similar_posts_slider_prev svg'),
        responsive: [
            {
                breakpoint: 1199,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 2,
                }
            },
            {
                breakpoint: 768,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1,
                }
            },
        ]
    });

    $('.blog_latest_slider').slick({
        slidesToShow: 3,
        slidesToScroll: 3,
        dots: false,
        // nextArrow: $('.similar_posts_slider_next svg'),
        // prevArrow: $('.similar_posts_slider_prev svg')
    });

    function single_post_thumbnail() {

        let image = $('.single_post_thumbnail'),
            windowWidth = $(window).width(),
            contentWidth = $('.content_section').width(),
            margin = (windowWidth - contentWidth) / 2;
        if ($(window).width() > 992) {
            if (image.length) {
                image.css({
                    'width': windowWidth + 'px',
                    'margin-left': '-' + margin + 'px',
                    'margin-right': '-' + margin + 'px',
                    'max-width': windowWidth
                });
                $('.share').css({
                    'padding-top': image.height() + image.offset().top - $('header').height() + 'px'
                });
                $('.start').css({
                    'padding-top': image.height() + image.offset().top - $('header').height() + 'px'
                })
            }
        }

        $(window).scroll(function () {
            if ($(window).width() > 992) {
                var scrollTop = $(window).scrollTop();
                let share = $('.share'),
                    start = $('.start');
                if (share.length && start.length) {
                    if (scrollTop > image.height() + image.offset().top - $('header').height() && scrollTop < $('.content').height()) {
                        $('.share').css({
                            'padding-top': $(window).scrollTop() + 'px'
                        });
                        $('.start').css({
                            'padding-top': $(window).scrollTop() + 'px'
                        })
                    }
                }
            }
        })

    }

    single_post_thumbnail();

    $(window).on('resize', function () {
        single_post_thumbnail();
    });

    let sortButton = $('.blog_sort span');
    sortButton.on('click', function (event) {
        event.preventDefault;

        $.each(sortButton, function () {
            if ($(this).hasClass('button-filled-big')) {
                $(this).removeClass('button-filled-big');
                $(this).addClass('button-white-big');
            }
        });

        $(this).toggleClass('button-filled-big');
        $(this).toggleClass('button-white-big');

        let data = {
            action: 'blog_sort',
            term_id: $(this).attr('data-term_id')
        };

        $.ajax({
            url: ajax.url,
            type: 'POST',
            data: data,
            success: function (response) {
                if (response.type === 'all') {
                    let postsBlock = $(document).find('.blog_posts');
                    postsBlock
                        .empty()
                        .append(response.wrapper);
                    postsBlock
                        .find('.control')
                        .css({
                            'display': 'flex'
                        });

                    $('.content_title_main').empty();

                    $('.content_title').text(response.title);
                    $.each(response.posts.latest, function () {
                        postsBlock
                            .find('.latest')
                            .find('.posts_wrapper')
                            .append(this);
                    });
                    $.each(response.posts.popular, function () {
                        postsBlock
                            .find('.popular')
                            .find('.posts_wrapper')
                            .append(this);
                    });
                    postsBlock
                        .find('.popular')
                        .find('.posts_wrapper')
                        .slick({
                            slidesToShow: 3,
                            slidesToScroll: 3,
                            dots: false,
                            prevArrow: '',
                            nextArrow: '<img class="next" src="' + settings.distUrl + '/img/blog_slider_next.png">',
                            responsive: [
                                {
                                    breakpoint: 1199,
                                    settings: {
                                        slidesToShow: 2,
                                        slidesToScroll: 2,
                                    }
                                },
                                {
                                    breakpoint: 768,
                                    settings: {
                                        slidesToShow: 1,
                                        slidesToScroll: 1,
                                    }
                                },
                            ]
                        });
                    postsBlock
                        .find('.latest')
                        .find('.posts_wrapper')
                        .slick({
                            slidesToShow: 3,
                            slidesToScroll: 3,
                            dots: false,
                            prevArrow: '',
                            nextArrow: '<img class="next" src="' + settings.distUrl + '/img/blog_slider_next.png">',
                            responsive: [
                                {
                                    breakpoint: 1199,
                                    settings: {
                                        slidesToShow: 2,
                                        slidesToScroll: 2,
                                    }
                                },
                                {
                                    breakpoint: 768,
                                    settings: {
                                        slidesToShow: 1,
                                        slidesToScroll: 1,
                                    }
                                },
                            ]
                        });
                    postsBlock
                        .find('.popular')
                        .find('.content_title')
                        .find('.title')
                        .text(response.posts.popular.title);

                    postsBlock
                        .find('.latest')
                        .find('.content_title')
                        .find('.title')
                        .text(response.posts.latest.title);

                    postsBlock
                        .find('.content_title')
                        .find('.control')
                        .text('Show more');

                } else {
                    $('.content_title_main')
                        .text(response.title);
                    $('.blog_posts')
                        .empty();
                    $.each(response.posts, function () {
                        $('.blog_posts').append(this);
                    })
                }
            }
        })

    });

    if (window.location.pathname === '/blog/') {
        let data = {
            action: 'blog_sort',
            term_id: 'all'
        };

        $.ajax({
            url: ajax.url,
            type: 'POST',
            data: data,
            success: function (response) {
                let postsBlock = $('.blog_posts');
                $('.content_title').text(response.title);
                $.each(response.posts.latest, function () {
                    $('.blog_posts')
                        .find('.latest')
                        .find('.posts_wrapper')
                        .append(this);
                });
                $.each(response.posts.popular, function () {
                    $('.blog_posts')
                        .find('.popular')
                        .find('.posts_wrapper')
                        .append(this);
                });

                postsBlock
                    .find('.control')
                    .css({
                        'display': 'flex'
                    });
                postsBlock
                    .find('.popular')
                    .find('.posts_wrapper')
                    .slick({
                        slidesToShow: 3,
                        slidesToScroll: 3,
                        dots: false,
                        prevArrow: '',
                        nextArrow: '<img class="next" src="' + settings.distUrl + '/img/blog_slider_next.png">',
                        responsive: [
                            {
                                breakpoint: 1199,
                                settings: {
                                    slidesToShow: 2,
                                    slidesToScroll: 2,
                                }
                            },
                            {
                                breakpoint: 768,
                                settings: {
                                    slidesToShow: 1,
                                    slidesToScroll: 1,
                                }
                            },
                        ]
                    });
                postsBlock
                    .find('.latest')
                    .find('.posts_wrapper')
                    .slick({
                        slidesToShow: 3,
                        slidesToScroll: 3,
                        dots: false,
                        prevArrow: '',
                        nextArrow: '<img class="next" src="' + settings.distUrl + '/img/blog_slider_next.png">',
                        responsive: [
                            {
                                breakpoint: 1199,
                                settings: {
                                    slidesToShow: 2,
                                    slidesToScroll: 2,
                                }
                            },
                            {
                                breakpoint: 768,
                                settings: {
                                    slidesToShow: 1,
                                    slidesToScroll: 1,
                                }
                            },
                        ]
                    });
                postsBlock
                    .find('.popular')
                    .find('.content_title')
                    .find('.title')
                    .text(response.posts.popular.title);

                postsBlock
                    .find('.latest')
                    .find('.content_title')
                    .find('.title')
                    .text(response.posts.latest.title);

                postsBlock
                    .find('.content_title')
                    .find('.control')
                    .text('Show more');
            }
        })
    }

    $(document).on('click', '.blog_posts .content_title .control', function () {
        if ($(this).hasClass('show_all')) {
            $(this)
                .removeClass('show_all')
                .text('Show more');
            $(this)
                .parent()
                .parent()
                .find('.posts_wrapper')
                .removeClass('show_all')
                .slick({
                    slidesToShow: 3,
                    slidesToScroll: 3,
                    dots: false,
                    prevArrow: '',
                    nextArrow: '<img class="next" src="' + settings.distUrl + '/img/blog_slider_next.png">',
                    responsive: [
                        {
                            breakpoint: 1199,
                            settings: {
                                slidesToShow: 2,
                                slidesToScroll: 2,
                            }
                        },
                    ]
                });

        } else {
            $(this)
                .addClass('show_all')
                .text('Hide');
            $(this)
                .parent()
                .parent()
                .find('.posts_wrapper')
                .addClass('show_all')
                .slick('unslick');
        }
    });


    if (window.location.hash.length > 0) {

        $('html, body').animate({
            scrollTop: $(window.location.hash).offset().top - 150
        }, 500);
    }

    $('.hire_us').find('a').on('click', function () {
        let contactSection = $(document).find('#contact_us');

        console.log(contactSection);

        if(!contactSection.length > 0) {
            window.location.replace(ajax.site_url + '#contact_us');
        }
    });

    $(document).on('click', 'a[href^="#"]', function (event) {
        event.preventDefault();

        $('html, body').animate({
            scrollTop: $($.attr(this, 'href')).offset().top - 150
        }, 500);
    });


    // Our team carousel

    // http://madewithenvy.com/ecosystem/articles/2015/exploring-order-flexbox-carousel/
    var $carousel = $('.carousel');
    var $seats = $('.carousel-seat');

    $('.toggle').on('click', function (e) {
        var $newSeat;
        var $el = $('.is-ref');
        var $currSliderControl = $(e.currentTarget);
        // Info: e.target is what triggers the event dispatcher to trigger and e.currentTarget is what you assigned your listener to.

        $el.removeClass('is-ref');
        if ($currSliderControl.data('toggle') === 'next') {
            $newSeat = next($el);
            $carousel.removeClass('is-reversing');
        } else {
            $newSeat = prev($el);
            $carousel.addClass('is-reversing');
        }

        $newSeat.addClass('is-ref').css('order', 1);
        for (var i = 2; i <= $seats.length; i++) {
            $newSeat = next($newSeat).css('order', i);
            stair($newSeat, i);
        }

        $carousel.removeClass('is-set');
        return setTimeout(function () {
            return $carousel.addClass('is-set');
        }, 50);

        function stair($el, index) {
            unstair($el);
            if (index === 2) {
                first($el)
            } else if (index === 3) {
                second($el)
            } else if (index === 4) {
                last($el)
            }
        }

        function unstair($el) {
            $el.removeClass('card-first');
            $el.removeClass('card-second');
            $el.removeClass('card-last');
        }

        function first($el) {
            $el.addClass('card-first')
        }

        function second($el) {
            $el.addClass('card-second')
        }

        function last($el) {
            $el.addClass('card-last');
            $.each($('.carousel-content').find('li'), function () {

                if ($(this).hasClass('active')) {
                    $(this).fadeOut(300).removeClass('active');
                }
                if ($(this).attr('data-slide') === $el.attr('data-slide')) {
                    console.log($(this));
                    $(this).addClass('active').fadeIn(300);
                }

            });
            console.log($el.attr('data-slide'));

        }

        function next($el) {
            if ($el.next().length) {
                return $el.next();
            } else {
                return $seats.first();
            }
        }

        function prev($el) {
            if ($el.prev().length) {
                return $el.prev();
            } else {
                return $seats.last();
            }
        }
    });

    $(window).scroll(function () {
        if ($(this).scrollTop() > 100) {
            $('.scrollup')
                .fadeIn()
                .css({
                    'display': 'flex'
                });
        } else {
            $('.scrollup')
                .fadeOut();
        }

        // var scrollTop = $(window).scrollTop();
        //
        // if(scrollTop > 1072 && scrollTop < $('.content').height()) {
        //     $('.share').css({
        //         'padding-top' : $(window).scrollTop() + 75 + 'px'
        //     });
        //     $('.start').css({
        //         'padding-top' : $(window).scrollTop() + 75 + 'px'
        //     })
        // }

    });

    $('.scrollup').click(function () {
        $("html, body").animate({
            scrollTop: 0
        }, 600);
        return false;
    });


    $('#gdpr_accept').on('click', function () {
        document.cookie = 'gdpr_accept=' + true +'';
        $(this)
            .closest('.gdpr-banner')
            .fadeOut(300)
            .remove();

    })

});